{% extends 'base.html' %}

{% block title %}Mis Prendas - EcoPrenda{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-8">
                <h2><i class="bi bi-bag-check"></i> Mis Prendas</h2>
                <p class="text-muted">Gestiona tus prendas publicadas</p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{% url 'crear_prenda' %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Nueva Prenda
                </a>
            </div>
        </div>

        {% if prendas %}
        <div class="row">
            {% for prenda in prendas %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                    {% if prenda.imagen_prenda %}
                    <img src="{{ prenda.imagen_prenda.url }}" class="card-img-top" alt="Imagen de {{ prenda.nombre }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                    <div class="card-img-top d-flex align-items-center justify-content-center bg-light text-muted" style="height: 200px;">
                        <span>Sin imagen</span>
                    </div>
                    {% endif %}
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge bg-success">{{ prenda.categoria }}</span>
                            <span class="badge {% if prenda.estado == 'DISPONIBLE' %}bg-success{% elif prenda.estado == 'RESERVADA' or prenda.estado == 'EN_PROCESO_ENTREGA' %}bg-warning{% elif prenda.estado == 'COMPLETADA' %}bg-info{% else %}bg-secondary{% endif %}">
                                {{ prenda.get_estado_display }}
                            </span>
                        </div>
                        <h5 class="card-title">{{ prenda.nombre }}</h5>
                        <p class="card-text text-muted">{{ prenda.descripcion|truncatewords:15 }}</p>
                        
                        <div class="mb-3">
                            <small><strong>Talla:</strong> {{ prenda.talla }}</small><br>
                            <small class="text-muted">
                                <i class="bi bi-calendar"></i> {{ prenda.fecha_publicacion|date:"d/m/Y" }}
                            </small>
                        </div>

                        <!-- Acciones según estado -->
                        <div class="d-grid gap-2 mt-auto">
                            {% if prenda.estado == 'DISPONIBLE' %}
                                <a href="{% url 'detalle_prenda' prenda.id_prenda %}" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-eye"></i> Ver Detalle
                                </a>
                                <a href="{% url 'editar_prenda' prenda.id_prenda %}" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-pencil"></i> Editar
                                </a>
                                <a href="{% url 'eliminar_prenda' prenda.id_prenda %}" class="btn btn-outline-danger btn-sm">
                                    <i class="bi bi-trash"></i> Eliminar
                                </a>
                            {% elif prenda.estado == 'RESERVADA' or prenda.estado == 'EN_PROCESO_ENTREGA' %}
                                <a href="{% url 'detalle_prenda' prenda.id_prenda %}" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-eye"></i> Ver Detalle
                                </a>
                                {% if prenda.transaccion_activa %}
                                    <a href="{% url 'marcar-entregada' prenda.transaccion_activa.id_transaccion %}" class="btn btn-success btn-sm">
                                        <i class="bi bi-check"></i> Marcar Entregada
                                    </a>
                                    <a href="{% url 'cancelar' prenda.transaccion_activa.id_transaccion %}" class="btn btn-warning btn-sm">
                                        <i class="bi bi-x"></i> Cancelar
                                    </a>
                                {% endif %}
                            {% elif prenda.estado == 'COMPLETADA' %}
                                <a href="{% url 'detalle_prenda' prenda.id_prenda %}" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-eye"></i> Ver Detalle
                                </a>
                                <span class="badge bg-success w-100">Transacción completada</span>
                            {% elif prenda.estado == 'CANCELADA' %}
                                <a href="{% url 'detalle_prenda' prenda.id_prenda %}" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-eye"></i> Ver Detalle
                                </a>
                                <span class="badge bg-danger w-100">Transacción cancelada</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h3 class="mt-3">No tienes prendas publicadas</h3>
            <p class="text-muted">Comienza publicando tu primera prenda</p>
            <a href="{% url 'crear_prenda' %}" class="btn btn-primary btn-lg mt-3">
                <i class="bi bi-plus-circle"></i> Publicar Primera Prenda
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}